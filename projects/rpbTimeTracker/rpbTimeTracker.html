<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPB Time Tracker</title>
    <style>
        :root {
            --background-color: #333;
            --text-color: #f4f4f4;
            --container-color: #444;
            --button-color: #007bff;
            --button-hover-color: #0056b3;
            --total-line-color: #000;
            --input-border-color: #ddd;
            --input-background-color: #555;
            --input-text-color: #ddd;
            --event-line-color: rgb(140, 140, 140);
        }

        body {
            font-family: Arial, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
        }

        .container {
            max-width: 94%;
            margin: 20px auto;
            padding: 0px 20px 12px 20px;
            background-color: var(--container-color);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .event-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .event-row input,
        .event-row select {
            flex: 1;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid var(--input-border-color);
            border-radius: 4px;
            background-color: var(--input-background-color);
            color: var(--input-text-color);
            flex-basis: 14%;
        }

        .event-row .subtotal,
        .event-row .hours-worked {
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }



        .event-row input:last-child,
        .event-row select:last-child {
            margin-right: 0;
        }

        .event-row input[placeholder],
        .event-row select[placeholder] {
            font-style: italic;
        }

        .add-event {
            background-color: var(--button-color);
            color: white;
            padding: 10px 20px;
            text-align: center;
            display: block;
            width: auto;
            margin: 10px 0;
            cursor: pointer;
        }

        .add-event:hover {
            background-color: var(--button-hover-color);
        }

        .total-line {
            border-top: 2px solid var(--total-line-color);
            margin: 20px 0;
        }

        .event-line {
            border-top: 1px solid var(--event-line-color);
            margin: 10px 0;
        }

        .total-due {
            text-align: right;
            margin: 10px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .email-preview {
            width: 98%;
            height: 200px;
            margin-top: 20px;
            padding: 10px;
            border: 1px solid var(--input-border-color);
            border-radius: 4px;
            background-color: var(--input-background-color);
            color: var(--input-text-color);
        }

        button {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #218838;
        }

        @media (max-width: 600px) {
            .event-row {
                flex-direction: column;
            }

            .event-row input,
            .event-row select {
                margin-bottom: 10px;
            }

            .header {
                flex-direction: column;
                align-items: flex-start;
            }

            #Employee {
                width: 100%;
                /* adjust as needed */
            }
        }

        #Employee {
            flex: 1;
            padding: 10px;
            margin-right: 10px;
            border: 1px solid var(--input-border-color);
            border-radius: 4px;
            background-color: var(--input-background-color);
            color: var(--input-text-color);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    </style>

</head>

<body>
    <div class="container">

        <div class="header">
            <h1>RPB Time Tracker</h1>
            <p style="font-size: 0.8em; color: rgb(187, 187, 187);">&nbsp;&nbsp;Select an employee, add events, and click "Send Email" when done.
                If
                venue does not appear, select "Other: See Notes".&nbsp;&nbsp;</p>
            <select id="Employee" class="Employee">
                <option selected disabled>Employee</option>
                <option value="John Mobley">John Mobley</option>
                <option value="Samantha">Samantha</option>
                <option value="Sarah Bryant">Sarah Bryant</option>
                <option value="Teralynn Mikell">Terralynn Mikell</option>
                <!-- More employees -->
            </select>

        </div>
        <div class="total-line"></div>
        <div id="events-container">
            <!-- Event rows will be added here -->
        </div>
        <button class="add-event" onclick="addEvent()">Add Event</button>
        <div class="total-line"></div>
        <div class="total-due">Total Due: $<span id="total-due">0.00</span></div>
        <textarea class="email-preview" id="email-preview" readonly></textarea>
        <button onclick="sendEmail()">Send Email</button>
    </div>

    <script>
        var events = [];
        var totalDue = 0;



        function addEventWithData(venue, startTime, notes, endTime, rate) {
            var eventRow = document.createElement('div');
            eventRow.className = 'event-row';
            eventRow.innerHTML = `
                <select>
                    <option selected disabled>Venue</option>
                    <option value="The Cardinal">The Cardinal</option>
                    <option value="Common House">Common House</option>
                    <option value="Estate At River Run">Estate At River Run</option>
                    <option value="Mill At Mattaponni Springs">Mill At Mattaponni Springs</option>
                    <option value="Mill At Fine Creek">Mill At Fine Creek</option>
                    <option value="Dover Hall">Dover Hall</option>
                    <option value="The Boathouse">The Boathouse</option>
                    <option value="Gallery5">Gallery5</option>
                    <option value="Estate At River Run">Estate At River Run</option>
                    <option value="Other: See Notes">Other: See Notes</option>
                </select>
                <input type="datetime-local" placeholder="Start Time" value="${startTime}">
                <input type="text" placeholder="Notes" value="${notes}">
                <input type="datetime-local" placeholder="End Time" value="${endTime}">
                <select>
                    <option selected disabled>Rate</option>
                    <option value="15">Training - $15/hr</option>
                    <option value="15">BIZ DEV - $15/hr</option>
                    <option value="20">Digital On-Call - $20/hr</option>
                    <option value="20">Printer Duo - $20/hr</option>
                    <option value="25">Printer Solo - $25/hr</option>
                    <option value="30">Promoted Printer Solo - $30/hr</option>
                </select>
                <div class="hours-worked">Hours Worked: <span>0.00</span></div>
                <div class="subtotal">Daily Total: <span>$0.00</span></div>
            `;
            // Set the venue and rate
            eventRow.querySelector('select:nth-child(1)').value = venue;
            eventRow.querySelector('select:nth-child(5)').value = rate;
            // Attach onchange event to inputs and selects
            eventRow.querySelectorAll('input, select').forEach(function (input) {
                input.onchange = update;
            });
            document.getElementById('events-container').appendChild(eventRow);
            events.push(eventRow);
            var eventLine = document.createElement('div');
            eventLine.className = 'event-line';
            document.getElementById('events-container').appendChild(eventLine);
        }

        function addEvent() {
            var eventRow = document.createElement('div');
            eventRow.className = 'event-row';
            eventRow.innerHTML = `
                <select>
                    <option selected disabled>Venue</option>
                    <option value="The Cardinal">The Cardinal</option>
                    <option value="Common House">Common House</option>
                    <option value="Estate At River Run">Estate At River Run</option>
                    <option value="Mill At Mattaponni Springs">Mill At Mattaponni Springs</option>
                    <option value="Mill At Fine Creek">Mill At Fine Creek</option>
                    <option value="Dover Hall">Dover Hall</option>
                    <option value="The Boathouse">The Boathouse</option>
                    <option value="Gallery5">Gallery5</option>
                    <option value="Estate At River Run">Estate At River Run</option>
                    <option value="Other: See Notes">Other: See Notes</option>
                </select>
                <input type="datetime-local" placeholder="Start Time">
                <input type="text" placeholder="Notes">
                <input type="datetime-local" placeholder="End Time">
                <select>
                    <option selected disabled>Rate</option>
                    <option value="15">Training - $15/hr</option>
                    <option value="15">BIZ DEV - $15/hr</option>
                    <option value="20">Digital On-Call - $20/hr</option>
                    <option value="20">Printer Duo - $20/hr</option>
                    <option value="25">Printer Solo - $25/hr</option>
                    <option value="30">Promoted Printer Solo - $30/hr</option>
                </select>
                <div class="hours-worked">Hours Worked: <span>0.00</span></div>
                <div class="subtotal">Daily Total: <span>$0.00</span></div>
            `;
            // Attach onchange event to inputs and selects
            eventRow.querySelectorAll('input, select').forEach(function (input) {
                input.onchange = update;
            });
            document.getElementById('events-container').appendChild(eventRow);
            events.push(eventRow);
            var eventLine = document.createElement('div');
            eventLine.className = 'event-line';
            document.getElementById('events-container').appendChild(eventLine);
        }

        function update() {
            updateHoursWorked();
            updateDailyTotals();
            updateTotalDue();
            updateEmailPreview();
        }

        function updateHoursWorked() {
            events.forEach(function (eventRow) {
                var startTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(2)').value;
                var endTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(4)').value;
                var hoursWorkedElement = eventRow.querySelector('.hours-worked');
                if (startTime && endTime) {
                    hoursWorkedElement.textContent = `Hours Worked: ${calcHours(startTime, endTime)}`;
                } else {
                    hoursWorkedElement.textContent = 'Hours Worked: 0.00';
                }
            });
        }

        function parseDatetime(datetime) {
            var [date, time] = datetime.split('T');
            var [year, month, day] = date.split('-');
            var [hour, minute] = time.split(':');
            return new Date(year, month - 1, day, hour, minute);
        }

        function calcHours(startTime, endTime) {
            var start = parseDatetime(startTime);
            var end = parseDatetime(endTime);
            var hoursWorked = (end.getTime() - start.getTime()) / 1000 / 60 / 60;
            return hoursWorked.toFixed(2);
        }

        function calculateTotalHours() {
            var totalHours = 0;
            events.forEach(function (eventRow) {
                var startTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(2)').value;
                var endTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(4)').value;
                if (startTime && endTime) {
                    var hoursWorked = calcHours(startTime, endTime);
                    totalHours += parseFloat(hoursWorked);
                }
            });
            return totalHours;
        }


        function calculatePay(startTime, endTime, rate) {
            var start = parseDatetime(startTime);
            var end = parseDatetime(endTime);
            if (isNaN(start) || isNaN(end) || isNaN(Number(rate))) {
                return '0.00';
            }
            var hoursWorked = (end - start) / 1000 / 60 / 60;
            var pay = hoursWorked * Number(rate);
            return pay.toFixed(2);
        }




        function updateDailyTotals() {
            events.forEach(function (eventRow) {
                var startTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(2)').value;
                var endTime = eventRow.querySelector('input[type="datetime-local"]:nth-child(4)').value;
                var rateElement = eventRow.querySelector('select:nth-child(5)');
                var rate = rateElement.options[rateElement.selectedIndex].value;
                var subtotalElement = eventRow.querySelector('.subtotal');
                if (startTime && endTime && rate) {
                    subtotalElement.textContent = `Daily Total:$${calculatePay(startTime, endTime, rate)}`;
                } else {
                    subtotalElement.textContent = '$0.00';
                }
            });
        }

        function diff_hours(dt2, dt1) {
            var diff = (dt2.getTime() - dt1.getTime()) / 1000;
            diff /= (60 * 60);
            return Math.abs(Math.round(diff));
        }

        function updateTotalDue() {
            var runningTotal = 0;
            events.forEach(function (eventRow) {
                var Tc = eventRow.querySelector('.subtotal').textContent;
                var subTc = Tc.substring(Tc.lastIndexOf("$") + 1, Tc.length);
                //alert(subTc);
                //alert(Tc.lastIndexOf("$"));
                var subtotal = parseFloat(subTc);
                runningTotal += subtotal;
            });
            totalDue = parseFloat(runningTotal.toFixed(2));
            document.getElementById('total-due').textContent = totalDue;

        }

        function sendEmail() {
            var result = document.getElementById('email-preview').value;
            var subject = encodeURIComponent('RPB Hours');
            var recipient = 'andrea@804photobooth.com';
            window.location.href = `mailto:${recipient}?subject=${subject}&body=${encodeURIComponent(result)}`;
        }

        function formatDateTime(datetime) {
            var options = { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' };
            return new Date(datetime).toLocaleString('en-US', options);
        }

        function formatDate(date) {
            var options = { month: 'numeric', day: 'numeric', year: 'numeric' };
            var dateString = new Date(date + 'T00:00').toLocaleString('en-US', options);
            var yearIndex = dateString.lastIndexOf("/") + 1;
            var lastTwoDigitsOfYear = dateString.substring(yearIndex + 2, yearIndex + 4);
            return dateString.substring(0, yearIndex) + lastTwoDigitsOfYear;
        }

        function formatMonthDay(date) {
            var options = { month: 'numeric', day: 'numeric' };
            return new Date(date).toLocaleString('en-US', options);
        }

        function updateEmailPreview() {
            var emailContent = '';
            var startDate = new Date(events[0].querySelector('input[type="datetime-local"]:nth-child(2)').value).toLocaleDateString();
            var endDate = new Date(events[events.length - 1].querySelector('input[type="datetime-local"]:nth-child(4)').value).toLocaleDateString();
            emailContent += "RPB Hours For " + document.getElementById("Employee").value + " " + startDate + "-" + endDate + "\n\n";
            try {
                events.forEach(function (eventRow) {
                    console.log('Processing eventRow');
                    var date = new Date(eventRow.querySelector('input[type="datetime-local"]:nth-child(2)').value).toLocaleDateString();
                    console.log('date:', date);
                    var venue = eventRow.querySelector('select:nth-child(1)').value;
                    console.log('venue:', venue);
                    var startTime = new Date(eventRow.querySelector('input[type="datetime-local"]:nth-child(2)').value).toLocaleTimeString();
                    console.log('startTime:', startTime);
                    var notes = eventRow.querySelector('input[type="text"]').value;
                    console.log('notes:', notes);
                    var endTime = new Date(eventRow.querySelector('input[type="datetime-local"]:nth-child(4)').value).toLocaleTimeString();
                    console.log('endTime:', endTime);
                    var hoursWorked = eventRow.querySelector('.hours-worked').textContent;
                    //var hoursWorked = calcHours(startTime, endTime);
                    console.log('hoursWorked:', hoursWorked);
                    var rate = eventRow.querySelector('select:nth-child(5)').value;
                    console.log('rate:', rate);
                    var rateElement = eventRow.querySelector('select:nth-child(5)');
                    var rateText = rateElement.options[rateElement.selectedIndex].textContent;
                    console.log('rateText:', rateText);
                    //var pay = calculatePay(startTime, endTime, rate);
                    var pay = eventRow.querySelector('.subtotal').textContent;
                    console.log('pay:', pay);
                    emailContent += `Date: ${date} | Venue: ${venue} | Start Time: ${startTime} | Notes: ${notes} | End Time: ${endTime} | ${hoursWorked} | Rate: ${rateText} | ${pay}\n\n`;
                    console.log('emailContent:', emailContent);
                });
            } catch (error) {
                console.error(error);
            }
            var totalHours = calculateTotalHours();
            emailContent += "Total Hours Worked: " + totalHours.toFixed(2) + "\n";
            emailContent += "Total Due: $" + document.getElementById('total-due').textContent;
            document.getElementById('email-preview').value = emailContent;
        }


        function getTotalDue() {
            console.log('Total Due:', totalDue);
            return totalDue;
        }
        var testing = false;
        if (!testing) {
            addEvent();
        } else {
            // Call addEventWithData with test data when the page loads
            window.onload = function () {
                document.getElementById("Employee").value = "John Mobley";
                addEventWithData('The Cardinal', '2024-04-25T09:00', 'Test notes', '2024-04-25T15:00', '15');
                addEventWithData('Common House', '2024-04-26T10:00', 'asdfasdf', '2024-04-26T12:00', '20');
                // Add more test data as needed

                update();
            };
        }
        document.getElementById("Employee").addEventListener("change", function () {
            update();
        });


    </script>
</body>

</html>
