<!DOCTYPE html>
<html>
<head>
  <style>
    #forest { display: none; }
    #canvas { border: 1px solid black; }
    #detectedColor {
      font-family: sans-serif;
      width: 50px; height: 50px; border: 1px solid black; margin: 10px; background-color: #fff;
    }
  </style>
</head>
<body>
  <img id="forest" src="Forest (3).png">
  <canvas id="canvas"></canvas>
  <p id="detectedColor"></p>

  <script>
    const canvas = document.getElementById('canvas'),
          ctx = canvas.getContext('2d'),
          image = document.getElementById('forest'),
          detectedColorDiv = document.getElementById('detectedColor');

    canvas.width = image.width;
    canvas.height = image.height;
    ctx.drawImage(image, 0, 0);

    const backgroundRed = 255, // Adjust these values as needed
          backgroundGreen = 255,
          backgroundBlue = 255;

    function getRandomBoundingBoxes(numSamples) {
      const sampleLocations = [];
      for (let i = 0; i < numSamples; i++) {
        const x = Math.floor(Math.random() * canvas.width);
        const y = Math.floor(Math.random() * canvas.height);
        const pixelIndex = (y * canvas.width + x) * 4;
        const imageData = ctx.getImageData(x, y, 1, 1).data;
        if (imageData[0] !== backgroundRed || imageData[1] !== backgroundGreen || imageData[2] !== backgroundBlue) {
          sampleLocations.push({ x, y });
          ctx.fillStyle = "rgba(255, 0, 0, 0.5)"; // Red with 50% transparency
          ctx.fillRect(x, y, 2, 2); // Draw a small red square at the sample location
        }
      }

      const threshold = Math.floor(numSamples * 0.01), // Adjust threshold
            boundingBoxes = [];
      for (let y = 0; y < canvas.height; y++) {
        for (let x = 0; x < canvas.width; x++) {
          if (sampleLocations.find(location => location.x === x && location.y === y)) {
            // Skip already processed samples (optional, for efficiency)
            continue;
          }
          if (sampleDistribution[y][x] > threshold) {
            let minX = x, minY = y, maxX = x, maxY = y;
            while (minX > 0 && sampleDistribution[minY][minX - 1] > threshold) minX--;
            while (maxX < canvas.width - 1 && sampleDistribution[minY][maxX + 1] > threshold) maxX++;
            while (minY > 0 && sampleDistribution[minY - 1][x] > threshold) minY--;
            while (maxY < canvas.height - 1 && sampleDistribution[maxY + 1][x] > threshold) maxY++;
            boundingBoxes.push({ x: minX, y: minY, width: maxX - minX + 1, height: maxY - minY + 1 });
          }
        }
      }

      return boundingBoxes;
    }

    image.onload = function() {
      ctx.willReadFrequently = true;
      const sampleLocations = getRandomBoundingBoxes(1000); // Adjust numSamples
      // Optional: Use the bounding boxes here (e.g., draw rectangles)
      console.log(sampleLocations); // Example usage (replace with your visualization logic)
    };
  </script>
</body>
</html>
