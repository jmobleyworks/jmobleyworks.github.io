<!DOCTYPE html><body><img id="forest" src="Forest (3).png" style="display: none;"><canvas id="canvas" style="border: 1px solid black;"></canvas><p id="detectedColor" style="font-family: sans-serif; width:50px;height:50px;border:1px solid black;margin:10px;"></p><script>
    var tolerance = 10, numSamples = 10, image = document.getElementById('forest'), canvas = document.getElementById('canvas'), detectedColorDiv = document.getElementById('detectedColor'), ctx = canvas.getContext('2d'), backgroundColor = null, seeds = [], extractedSprites = [], appendSpriteSize=300, debug = true;
    let isForeground = (testColor) => { return Math.abs(testColor[0] - backgroundColor[0]) > tolerance || Math.abs(testColor[1] - backgroundColor[1]) > tolerance || Math.abs(testColor[2] - backgroundColor[2]) > tolerance }
    let isBackground = (testColor) => { return Math.abs(testColor[0] - backgroundColor[0]) <= tolerance && Math.abs(testColor[1] - backgroundColor[1]) <= tolerance && Math.abs(testColor[2] - backgroundColor[2]) <= tolerance }
    function extractSprite(seed) {
        let sprite = ctx.getImageData(0, 0, canvas.width, canvas.height),minX = seed.x, minY = seed.y, maxX = seed.x, maxY = seed.y;
        let stack = [seed];
        while(stack.length > 0) {
            let point = stack.pop();
            let x = point.x, y = point.y;
            if(x < 0 || x >= canvas.width || y < 0 || y >= canvas.height) continue;
            let currentColor = [
                sprite.data[(y * canvas.width + x) * 4],
                sprite.data[(y * canvas.width + x) * 4 + 1],
                sprite.data[(y * canvas.width + x) * 4 + 2]
            ];
            if(isBackground(currentColor)) continue;
            minX = Math.min(minX, x);
            minY = Math.min(minY, y);
            maxX = Math.max(maxX, x);
            maxY = Math.max(maxY, y);
            sprite.data[(y * canvas.width + x) * 4 + 3] = 0; // Mark as visited
            stack.push({x: x+1, y: y});
            stack.push({x: x-1, y: y});
            stack.push({x: x, y: y+1});
            stack.push({x: x, y: y-1});
        }
        let spriteData = ctx.createImageData(maxX - minX + 1, maxY - minY + 1);
        for (let y = minY; y <= maxY; y++) {
            for (let x = minX; x <= maxX; x++) {
                let currentColor = [
                    sprite.data[(y * canvas.width + x) * 4],
                    sprite.data[(y * canvas.width + x) * 4 + 1],
                    sprite.data[(y * canvas.width + x) * 4 + 2]
                ];
                if (!isBackground(currentColor)) {
                    spriteData.data[((y - minY) * (maxX - minX + 1) + (x - minX)) * 4] = currentColor[0];
                    spriteData.data[((y - minY) * (maxX - minX + 1) + (x - minX)) * 4 + 1] = currentColor[1];
                    spriteData.data[((y - minY) * (maxX - minX + 1) + (x - minX)) * 4 + 2] = currentColor[2];
                    spriteData.data[((y - minY) * (maxX - minX + 1) + (x - minX)) * 4 + 3] = 255;
                }
            }
        }
        extractedSprites.push(spriteData);return spriteData;
    }
    let drawSprite = (sprite) => {var newCanvas = document.createElement('canvas');newCanvas.width = sprite.width;newCanvas.height = sprite.height;newCanvas.getContext('2d').putImageData(sprite, 0, 0);var img = document.createElement('img');img.src = newCanvas.toDataURL();img.width = appendSpriteSize; img.height = appendSpriteSize; document.body.appendChild(img);}
    document.getElementById('forest').onload = function() {
      canvas.width = image.width;canvas.height = image.height;ctx.drawImage(image, 0, 0); 
      backgroundColor = [ctx.getImageData(0, 0, 1, 1).data[0], ctx.getImageData(0, 0, 1, 1).data[1], ctx.getImageData(0, 0, 1, 1).data[2]];
      detectedColorDiv.style.backgroundColor = `rgb(${backgroundColor[0]}, ${backgroundColor[1]}, ${backgroundColor[2]})`;
      seeds = getRandomForegroundSeeds(canvas, isForeground, numSamples);
      if(debug){console.log("seeds.length="+seeds.length);ctx.fillStyle = 'red';seeds.forEach(seed => ctx.fillRect(seed.x, seed.y, 5, 5));}
      seeds.forEach(seed => {drawSprite(extractSprite(seed));});
    };
    function getRandomForegroundSeeds(canvas, isForeground, numSamples) {return Array.from({ length: numSamples }).map(() => ({ x: Math.floor(Math.random() * canvas.width), y: Math.floor(Math.random() * canvas.height) })).filter(point => isForeground(ctx.getImageData(point.x, point.y, 1, 1).data));}
  </script>
</body>
</html>
