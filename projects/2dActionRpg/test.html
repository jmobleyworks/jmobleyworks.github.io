<!DOCTYPE html>
<html>
<head><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"></head>
<body style="margin: 0; overflow: hidden;">
<script>
const c = Object.assign(document.createElement('canvas'), {width: window.innerWidth, height: window.innerHeight, style: 'position: absolute; top: 0; left: 0; background: black;'}), ctx = c.getContext('2d'), rw = 256, rh = 224, s = Math.min(window.innerWidth / rw, window.innerHeight / rh), ps = 2, smMax = 100, smRegen = 0.5, lifeMax = 3;
document.body.appendChild(c);
let px = rw / 2, py = rh / 2, ex = Math.random() * rw, ey = Math.random() * rh, es = 2, ms = 1, rs = 3, ir = false, mi, sm = smMax, pl = lifeMax, el = lifeMax, as = null, dir = 'right';

const draw = () => { ctx.fillStyle = 'black'; ctx.fillRect(0, 0, c.width, c.height); ctx.save(); ctx.scale(s, s); ctx.fillStyle = 'white'; ctx.fillRect(px, py, ps, ps); ctx.fillStyle = 'red'; ctx.fillRect(ex, ey, es, es); ctx.fillStyle = 'yellow'; ctx.fillRect(10, 10, sm, 5); ctx.fillStyle = 'green'; ctx.fillRect(10, 20, pl * 30, 5); ctx.fillStyle = 'green'; ctx.fillRect(rw - 10 - el * 30, 20, el * 30, 5); if (as) { ctx.fillStyle = 'yellow'; switch (dir) { case 'up': ctx.fillRect(px, py - ps * as.multiplier, ps, ps * as.multiplier); break; case 'down': ctx.fillRect(px, py, ps, ps * as.multiplier); break; case 'left': ctx.fillRect(px - ps * as.multiplier, py, ps * as.multiplier, ps); break; case 'right': ctx.fillRect(px, py, ps * as.multiplier, ps); break; } } ctx.restore(); };

const update = () => { sm = Math.min(sm + smRegen, smMax); draw(); moveEnemy(); checkCollision(); requestAnimationFrame(update); if (as && Date.now() - as.start > 200) as = null; };
const movePlayer = (dx, dy) => { px = Math.max(0, Math.min(rw - ps, px + dx)); py = Math.max(0, Math.min(rh - ps, py + dy)); if (dx > 0) dir = 'right'; else if (dx < 0) dir = 'left'; else if (dy > 0) dir = 'down'; else if (dy < 0) dir = 'up'; };
window.addEventListener('keydown', (e) => { if (e.key === 'ArrowUp' || e.key === 'w') movePlayer(0, -ms); else if (e.key === 'ArrowDown' || e.key === 's') movePlayer(0, ms); else if (e.key === 'ArrowLeft' || e.key === 'a') movePlayer(-ms, 0); else if (e.key === 'ArrowRight' || e.key === 'd') movePlayer(ms, 0); else if (['h', 'z'].includes(e.key)) attack(2, 'thrust'); else if (['j', 'x'].includes(e.key)) attack(3, 'quarter'); else if (['k', 'c'].includes(e.key)) attack(4, 'half'); else if (['l', 'v'].includes(e.key)) attack(5, 'full'); });

const createButton = (x, y, size, label, onStart, onEnd) => { const btn = Object.assign(document.createElement('div'), {style: `position: absolute; left: ${x}px; top: ${y}px; width: ${size}px; height: ${size}px; background-color: rgba(255, 255, 255, 0.5); border-radius: 50%; display: flex; align-items: center; justify-content: center; user-select: none;`, innerText: label}); let lt = 0; const handlerStart = (e) => { e.preventDefault(); const ct = new Date().getTime(), tl = ct - lt; lt = ct; ir = tl < 300; onStart(); mi = setInterval(onStart, ir ? 50 : 100); }; const handlerEnd = (e) => { e.preventDefault(); clearInterval(mi); onEnd(); }; btn.addEventListener('touchstart', handlerStart); btn.addEventListener('touchend', handlerEnd); btn.addEventListener('mousedown', handlerStart); btn.addEventListener('mouseup', handlerEnd); document.body.appendChild(btn); };
const ds = 50, bs = 50;
[['↑', 60, c.height - 150, ds, () => movePlayer(0, -ms)], ['↓', 60, c.height - 60, ds, () => movePlayer(0, ms)], ['←', 10, c.height - 105, ds, () => movePlayer(-ms, 0)], ['→', 110, c.height - 105, ds, () => movePlayer(ms, 0)], ['H', c.width - 210, c.height - 60, bs, () => attack(2, 'thrust')], ['J', c.width - 160, c.height - 60, bs, () => attack(3, 'quarter')], ['K', c.width - 110, c.height - 60, bs, () => attack(4, 'half')], ['L', c.width - 60, c.height - 60, bs, () => attack(5, 'full')]].forEach(([label, x, y, size, onStart]) => createButton(x, y, size, label, onStart, () => {}));

const attack = (multiplier, type) => { if (sm >= multiplier) { as = {multiplier, start: Date.now(), type}; sm -= multiplier; const knockback = () => { let dx = 0, dy = 0; if (dir === 'up') dy = -5; else if (dir === 'down') dy = 5; else if (dir === 'left') dx = -5; else if (dir === 'right') dx = 5; ex = Math.max(0, Math.min(rw - es, ex + dx)); ey = Math.max(0, Math.min(rh - es, ey + dy)); }; if (checkHit(ex, ey, px, py, ps, multiplier)) { el--; knockback(); if (el <= 0) console.log('Enemy defeated!'); } if (checkHit(px, py, ex, ey, es, multiplier)) pl--; if (pl <= 0) console.log('Player defeated!'); } };

const checkHit = (tx, ty, x, y, size, multiplier) => { switch (dir) { case 'up': return x < tx + size && x + size > tx && y - size * multiplier < ty + size && y > ty; case 'down': return x < tx + size && x + size > tx && y < ty + size && y + size * multiplier > ty; case 'left': return x - size * multiplier < tx + size && x > tx && y < ty + size && y + size > ty; case 'right': return x < tx + size && x + size * multiplier > tx && y < ty + size && y + size > ty; } };

const moveEnemy = () => { let dx = px - ex, dy = py - ey, dist = Math.sqrt(dx * dx + dy * dy); if (dist > 0) { dx /= dist; dy /= dist; } ex = Math.max(0, Math.min(rw - es, ex + dx * ms)); ey = Math.max(0, Math.min(rh - es, ey + dy * ms)); };

const checkCollision = () => { if (px < ex + es && px + ps > ex && py < ey + es && py + ps > ey) { pl--; if (pl <= 0) console.log('Player defeated!'); } };

update();
</script>
</body>
</html>
